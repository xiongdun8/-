"""
py3模块：六爻卦宫判断核心逻辑（64卦完整版）
直接收录64卦完整信息，通过精确匹配判断，避免规则推导错误
"""

# 64卦完整信息字典
# 键：转换后的阴阳列表（字符串形式，便于匹配）
# 值：卦信息（宫名、世爻索引、应爻索引、卦类型、卦名）
HEXAGRAMS = {
    # 乾宫八卦(
    "1,1,1,1,1,1": {"宫名": "乾宫", "世爻索引": 5, "应爻索引": 2, "卦类型": "本宫卦", "卦名": "乾为天"},
    "0,1,1,1,1,1": {"宫名": "乾宫", "世爻索引": 0, "应爻索引": 3, "卦类型": "一世卦", "卦名": "天风姤"},
    "0,0,1,1,1,1": {"宫名": "乾宫", "世爻索引": 1, "应爻索引": 4, "卦类型": "二世卦", "卦名": "天山遁"},
    "0,0,0,1,1,1": {"宫名": "乾宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "三世卦", "卦名": "天地否"},
    "0,0,0,0,1,1": {"宫名": "乾宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "四世卦", "卦名": "风地观"},
    "0,0,0,0,0,1": {"宫名": "乾宫", "世爻索引": 4, "应爻索引": 1, "卦类型": "五世卦", "卦名": "山地剥"},
    "0,0,0,1,0,1": {"宫名": "乾宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "游魂卦", "卦名": "火地晋"},
    "1,1,1,1,0,1": {"宫名": "乾宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "归魂卦", "卦名": "火天大有"},

    # 坤宫八卦(
    "0,0,0,0,0,0": {"宫名": "坤宫", "世爻索引": 5, "应爻索引": 2, "卦类型": "本宫卦", "卦名": "坤为地"},
    "1,0,0,0,0,0": {"宫名": "坤宫", "世爻索引": 0, "应爻索引": 3, "卦类型": "一世卦", "卦名": "地雷复"},
    "1,1,0,0,0,0": {"宫名": "坤宫", "世爻索引": 1, "应爻索引": 4, "卦类型": "二世卦", "卦名": "地泽临"},
    "1,1,1,0,0,0": {"宫名": "坤宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "三世卦", "卦名": "地天泰"},
    "1,1,1,1,0,0": {"宫名": "坤宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "四世卦", "卦名": "雷天大壮"},
    "1,1,1,1,1,0": {"宫名": "坤宫", "世爻索引": 4, "应爻索引": 1, "卦类型": "五世卦", "卦名": "泽天夬"},
    "1,1,1,0,1,0": {"宫名": "坤宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "游魂卦", "卦名": "水天需"},
    "0,0,0,0,1,0": {"宫名": "坤宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "归魂卦", "卦名": "水地比"},

    # 震宫八卦(
    "1,0,0,1,0,0": {"宫名": "震宫", "世爻索引": 5, "应爻索引": 2, "卦类型": "本宫卦", "卦名": "震为雷"},
    "0,0,0,1,0,0": {"宫名": "震宫", "世爻索引": 0, "应爻索引": 3, "卦类型": "一世卦", "卦名": "雷地豫"},
    "0,1,0,1,0,0": {"宫名": "震宫", "世爻索引": 1, "应爻索引": 4, "卦类型": "二世卦", "卦名": "雷水解"},
    "0,1,1,1,0,0": {"宫名": "震宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "三世卦", "卦名": "雷风恒"},
    "0,1,1,0,0,0": {"宫名": "震宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "四世卦", "卦名": "地风升"},
    "0,1,1,0,1,0": {"宫名": "震宫", "世爻索引": 4, "应爻索引": 1, "卦类型": "五世卦", "卦名": "水风井"},
    "0,1,1,1,1,0": {"宫名": "震宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "游魂卦", "卦名": "泽风大过"},
    "1,0,0,1,1,0": {"宫名": "震宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "归魂卦", "卦名": "泽雷随"},

    # 巽宫八卦(
    "0,1,1,0,1,1": {"宫名": "巽宫", "世爻索引": 5, "应爻索引": 2, "卦类型": "本宫卦", "卦名": "巽为风"},
    "1,1,1,0,1,1": {"宫名": "巽宫", "世爻索引": 0, "应爻索引": 3, "卦类型": "一世卦", "卦名": "风天小畜"},
    "1,0,1,0,1,1": {"宫名": "巽宫", "世爻索引": 1, "应爻索引": 4, "卦类型": "二世卦", "卦名": "风火家人"},
    "1,0,0,0,1,1": {"宫名": "巽宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "三世卦", "卦名": "风雷益"},
    "1,0,0,1,1,1": {"宫名": "巽宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "四世卦", "卦名": "天雷无妄"},
    "1,0,0,1,0,1": {"宫名": "巽宫", "世爻索引": 4, "应爻索引": 1, "卦类型": "五世卦", "卦名": "火雷噬嗑"},
    "1,0,0,0,0,1": {"宫名": "巽宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "游魂卦", "卦名": "山雷颐"},
    "0,1,1,0,0,1": {"宫名": "巽宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "归魂卦", "卦名": "山风蛊"},

    # 坎宫八卦(
    "0,1,0,0,1,0": {"宫名": "坎宫", "世爻索引": 5, "应爻索引": 2, "卦类型": "本宫卦", "卦名": "坎为水"},
    "1,1,0,0,1,0": {"宫名": "坎宫", "世爻索引": 0, "应爻索引": 3, "卦类型": "一世卦", "卦名": "水泽节"},
    "1,0,0,0,1,0": {"宫名": "坎宫", "世爻索引": 1, "应爻索引": 4, "卦类型": "二世卦", "卦名": "水雷屯"},
    "1,0,1,0,1,0": {"宫名": "坎宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "三世卦", "卦名": "水火既济"},
    "1,0,1,1,1,0": {"宫名": "坎宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "四世卦", "卦名": "泽火革"},
    "1,0,1,1,0,0": {"宫名": "坎宫", "世爻索引": 4, "应爻索引": 1, "卦类型": "五世卦", "卦名": "雷火丰"},
    "1,0,1,0,0,0": {"宫名": "坎宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "游魂卦", "卦名": "地火明夷"},
    "0,1,0,0,0,0": {"宫名": "坎宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "归魂卦", "卦名": "地水师"},

    # 离宫八卦(
    "1,0,1,1,0,1": {"宫名": "离宫", "世爻索引": 5, "应爻索引": 2, "卦类型": "本宫卦", "卦名": "离为火"},
    "0,0,1,1,0,1": {"宫名": "离宫", "世爻索引": 0, "应爻索引": 3, "卦类型": "一世卦", "卦名": "火山旅"},
    "0,1,1,1,0,1": {"宫名": "离宫", "世爻索引": 1, "应爻索引": 4, "卦类型": "二世卦", "卦名": "火风鼎"},
    "0,1,0,1,0,1": {"宫名": "离宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "三世卦", "卦名": "火水未济"},
    "0,1,0,0,0,1": {"宫名": "离宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "四世卦", "卦名": "山水蒙"},
    "0,1,0,0,1,1": {"宫名": "离宫", "世爻索引": 4, "应爻索引": 1, "卦类型": "五世卦", "卦名": "风水涣"},
    "0,1,0,1,1,1": {"宫名": "离宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "游魂卦", "卦名": "天水讼"},
    "1,0,1,1,1,1": {"宫名": "离宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "归魂卦", "卦名": "天火同人"},

    # 艮宫八卦（
    "0,0,1,0,0,1": {"宫名": "艮宫", "世爻索引": 5, "应爻索引": 2, "卦类型": "本宫卦", "卦名": "艮为山"},
    "1,0,1,0,0,1": {"宫名": "艮宫", "世爻索引": 0, "应爻索引": 3, "卦类型": "一世卦", "卦名": "山火贲"},
    "1,1,1,0,0,1": {"宫名": "艮宫", "世爻索引": 1, "应爻索引": 4, "卦类型": "二世卦", "卦名": "山天大畜"},
    "1,1,0,0,0,1": {"宫名": "艮宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "三世卦", "卦名": "山泽损"},
    "1,1,0,1,0,1": {"宫名": "艮宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "四世卦", "卦名": "火泽睽"},
    "1,1,0,1,1,1": {"宫名": "艮宫", "世爻索引": 4, "应爻索引": 1, "卦类型": "五世卦", "卦名": "天泽履"},
    "1,1,0,0,1,1": {"宫名": "艮宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "游魂卦", "卦名": "风泽中孚"},
    "0,0,1,0,1,1": {"宫名": "艮宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "归魂卦", "卦名": "风山渐"},

    # 兑宫八卦
    "1,1,0,1,1,0": {"宫名": "兑宫", "世爻索引": 5, "应爻索引": 2, "卦类型": "本宫卦", "卦名": "兑为泽"},
    "0,1,0,1,1,0": {"宫名": "兑宫", "世爻索引": 0, "应爻索引": 3, "卦类型": "一世卦", "卦名": "泽水困"},
    "0,0,0,1,1,0": {"宫名": "兑宫", "世爻索引": 1, "应爻索引": 4, "卦类型": "二世卦", "卦名": "泽地萃"},
    "0,0,1,1,1,0": {"宫名": "兑宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "三世卦", "卦名": "泽山咸"},
    "0,0,1,0,1,0": {"宫名": "兑宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "四世卦", "卦名": "水山蹇"},
    "0,0,1,0,0,0": {"宫名": "兑宫", "世爻索引": 4, "应爻索引": 1, "卦类型": "五世卦", "卦名": "地山谦"},
    "0,0,1,1,0,0": {"宫名": "兑宫", "世爻索引": 3, "应爻索引": 0, "卦类型": "游魂卦", "卦名": "雷山小过"},
    "1,1,0,1,0,0": {"宫名": "兑宫", "世爻索引": 2, "应爻索引": 5, "卦类型": "归魂卦", "卦名": "雷泽归妹"}
}


def convert_hexagram(hexagram):
    """将主程序1-4编码转换为0（阴）、1（阳）"""
    converted = []
    for line in hexagram:
        if line in [1, 4]:  # 少阴、纯阴为阴
            converted.append(0)
        elif line in [2, 3]:  # 少阳、纯阳为阳
            converted.append(1)
        else:
            raise ValueError(f"无效的爻值：{line}，必须是1-4")
    return converted


def get_hexagram_palace(hexagram):
    """通过64卦完整字典匹配，精确判断卦宫信息"""
    try:
        # 转换卦象并转为字符串键
        converted = convert_hexagram(hexagram)
        key = ",".join(map(str, converted))

        # 精确匹配字典
        if key in HEXAGRAMS:
            result = HEXAGRAMS[key].copy()
            # 确保返回格式包含必要字段
            return {
                "宫名": result["宫名"],
                "世爻索引": result["世爻索引"],
                "应爻索引": result["应爻索引"],
                "卦类型": result["卦类型"],
                "卦名": result["卦名"]
            }
        else:
            raise ValueError(f"未找到匹配卦象：{hexagram}（转换后：{converted}）")

    except Exception as e:
        return {"error": str(e)}

